<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>购物车</title>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <link rel="stylesheet" href="../style/base.css">
    <link rel="stylesheet" href="../style/shared.css">
    <link rel="stylesheet" href="./style/ShoppingCart.css">
</head>
<body>
<div id="box">
    <div class="Header">
        <p class="HeaderLeft">
            <span class="backIcon" onclick="window.history.back()"></span>
        </p>
        <p class="HeaderTitle">购物车 <span class="HeaderTitleIcon"></span></p>
        <p class="HeaderRight1 up">管理</p>
        <p class="HeaderRight2 down">完成</p>
    </div>

    <div class="Product">
        <div class="ProductBox">
            <ul class="ProductBoxItem" id="ProductBoxItem">
                <li class="ProductBoxItemIndex">
                    <div class="indexTop">
                        <p class="indexTopInput">
                            <input type="checkbox" class="check-all check">
                        </p>
                        <div class="indexTopShop">
                            <span class="indexTopIcon"></span>
                            <p class="indexTopType">
                                <span class="indexTopName">stephen</span>
                                <span class="indexTopGo"></span>
                            </p>
                        </div>
                    </div>
                    <ul class="indexCenterBox" >
                        <li class="indexCenter">
                            <p class="indexCenterCheck">
                                <input type="checkbox" class="indexCenterChecked check">
                            </p>
                            <div class="indexCenterRight">
                                <img class="indexCenterRightImage" src="image/001.jpg" alt="">
                                <div class="indexCenterRightSet">
                                    <p class="indexCenterRightSetText">好吃又廉价的酸菜鱼，近期打折优惠，满99元送大瓶雪碧或可乐一瓶，活到有效期2019年4月18号 -
                                        2019年4月22号</p>
                                    <p class="indexCenterRightSetTitle">1198张-时光去哪儿了</p>
                                    <div class="indexCenterRightSetNum">
                                        <p class="money">￥<span class="moneyNum">100</span></p>
                                        <div class="num">
                                            <p class="numLess">-</p>
                                            <p class="numCenter">1</p>
                                            <p class="numAdd">+</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </li>
                <li class="ProductBoxItemIndex">
                    <div class="indexTop">
                        <p class="indexTopInput">
                            <input type="checkbox" class="check-all check">
                        </p>
                        <div class="indexTopShop">
                            <span class="indexTopIcon"></span>
                            <p class="indexTopType">
                                <span class="indexTopName">stephen</span>
                                <span class="indexTopGo"></span>
                            </p>
                        </div>
                    </div>
                    <ul class="indexCenterBox" >
                        <li class="indexCenter">
                            <p class="indexCenterCheck">
                                <input type="checkbox" class="indexCenterChecked check">
                            </p>
                            <div class="indexCenterRight">
                                <img class="indexCenterRightImage" src="image/001.jpg" alt="">
                                <div class="indexCenterRightSet">
                                    <p class="indexCenterRightSetText">好吃又廉价的酸菜鱼，近期打折优惠，满99元送大瓶雪碧或可乐一瓶，活到有效期2019年4月18号 -
                                        2019年4月22号</p>
                                    <p class="indexCenterRightSetTitle">1198张-时光去哪儿了</p>
                                    <div class="indexCenterRightSetNum">
                                        <p class="money">￥<span class="moneyNum">100</span></p>
                                        <div class="num">
                                            <p class="numLess">-</p>
                                            <p class="numCenter">1</p>
                                            <p class="numAdd">+</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </li>
                <li class="ProductBoxItemIndex">
                    <div class="indexTop">
                        <p class="indexTopInput">
                            <input type="checkbox" class="check-all check">
                        </p>
                        <div class="indexTopShop">
                            <span class="indexTopIcon"></span>
                            <p class="indexTopType">
                                <span class="indexTopName">stephen</span>
                                <span class="indexTopGo"></span>
                            </p>
                        </div>
                    </div>
                    <ul class="indexCenterBox" >
                        <li class="indexCenter">
                            <p class="indexCenterCheck">
                                <input type="checkbox" class="indexCenterChecked check">
                            </p>
                            <div class="indexCenterRight">
                                <img class="indexCenterRightImage" src="image/001.jpg" alt="">
                                <div class="indexCenterRightSet">
                                    <p class="indexCenterRightSetText">好吃又廉价的酸菜鱼，近期打折优惠，满99元送大瓶雪碧或可乐一瓶，活到有效期2019年4月18号 -
                                        2019年4月22号</p>
                                    <p class="indexCenterRightSetTitle">1198张-时光去哪儿了</p>
                                    <div class="indexCenterRightSetNum">
                                        <p class="money">￥<span class="moneyNum">100</span></p>
                                        <div class="num">
                                            <p class="numLess">-</p>
                                            <p class="numCenter">1</p>
                                            <p class="numAdd">+</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </li>
                <li class="ProductBoxItemIndex">
                    <div class="indexTop">
                        <p class="indexTopInput">
                            <input type="checkbox" class="check-all check">
                        </p>
                        <div class="indexTopShop">
                            <span class="indexTopIcon"></span>
                            <p class="indexTopType">
                                <span class="indexTopName">stephen</span>
                                <span class="indexTopGo"></span>
                            </p>
                        </div>
                    </div>
                    <ul class="indexCenterBox" >
                        <li class="indexCenter">
                            <p class="indexCenterCheck">
                                <input type="checkbox" class="indexCenterChecked check">
                            </p>
                            <div class="indexCenterRight">
                                <img class="indexCenterRightImage" src="image/001.jpg" alt="">
                                <div class="indexCenterRightSet">
                                    <p class="indexCenterRightSetText">好吃又廉价的酸菜鱼，近期打折优惠，满99元送大瓶雪碧或可乐一瓶，活到有效期2019年4月18号 -
                                        2019年4月22号</p>
                                    <p class="indexCenterRightSetTitle">1198张-时光去哪儿了</p>
                                    <div class="indexCenterRightSetNum">
                                        <p class="money">￥<span class="moneyNum">100</span></p>
                                        <div class="num">
                                            <p class="numLess">-</p>
                                            <p class="numCenter">1</p>
                                            <p class="numAdd">+</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>

    <div class="footer">
        <div class="footerLeft">
            <div class="allCheck">
                <input type="checkbox" class="check-all check">
                <p class="all">全选</p>
            </div>
            <div class="allNum" style="flex: 1;height: 100%">
                <p class="footerLeftAll">总计:</p>
                <p class="footerLeftMoney" id="footerLeftMoney">￥<span class="Money" id="Money">0.00</span></p>
            </div>
        </div>
        <div class="footerRight">
            <p class="footerRightGo">结算(<span class="total" id="total">0</span>)</p>
            <p class="deleteType" onclick="$('.componentBox').show()">删除(<span id="deleteNum">0</span>)</p>
        </div>
    </div>
</div>
<p class="warn"></p>
<div class="loading">
    <div class="loadingItem">
        <p class="loadingImg"></p>
    </div>
</div>
<div class="componentBox" style="display: none">
    <div class="componentBoxSet">
        <div class="componentTop">
            <p class="componentTitle">共<span class="deleteSet">0</span>件,确定删除吗？</p>
        </div>
        <div class="componentBottom">
            <p class="componentNone" onclick="$('.componentBox').hide()">取消</p>
            <p class="componentDetermine">确定</p>
        </div>
    </div>
</div>
</body>
<script src="../script/jquery-3.2.1.js"></script>
<script src="./script/ShoppingCart.js"></script>
<script>
    $(function () {
        $('.up')[0].addEventListener('click', function () {
            $('.HeaderRight1').hide();
            $('.HeaderRight2').show();
            $('.footerRightGo').hide();
            $('.deleteType').show();
        });
        $('.down')[0].addEventListener('click', function () {
            $('.HeaderRight1').show();
            $('.HeaderRight2').hide();
            $('.footerRightGo').show();
            $('.deleteType').hide();
        });


        let checkInputs = document.getElementsByClassName('check');
        let checkAll = document.getElementsByClassName('check-all');
        let Money = document.getElementById('Money');
        let total = document.getElementById('total');
        let deleteNum = document.getElementById('deleteNum');
        let deleteBox = document.getElementsByClassName('componentDetermine')[0];
        let deleteSet = document.getElementsByClassName('deleteSet')[0];
        console.log(deleteBox);

        function getTotal() {
            let seleted = 0;
            let price = 0;
            let indexBox = document.getElementById("ProductBoxItem").getElementsByTagName("ul");
            for(let w=0; w<indexBox.length; w++){
                indexChildrenBox = indexBox[w].getElementsByTagName('li');
                for(let i=0; i<indexChildrenBox.length; i++){
                    if(indexChildrenBox[i].getElementsByTagName('input')[0].checked){
                        price += parseInt(indexChildrenBox[i].getElementsByTagName('span')[0].innerHTML);
                        seleted += parseFloat(indexChildrenBox[i].getElementsByTagName('p')[5].innerHTML);
                    }
                }
            }
            total.innerHTML = seleted;
            deleteNum.innerHTML = seleted;
            deleteSet.innerHTML = seleted;
            Money.innerText = price.toFixed(2);
        }

        function getSubTotal(children) {
            let price = children.getElementsByTagName('span')[0].innerHTML;
            let count = children.getElementsByTagName('p')[5].innerHTML;
            let SubTotal = parseFloat(price * count);
            console.log(SubTotal.toFixed(2));
            Money.innerText = SubTotal.toFixed(2);
        }

        let indexBox = document.getElementById("ProductBoxItem").getElementsByTagName("ul");
        for(let l=0; l<indexBox.length; l++){
            let indexChildrenBox = indexBox[l].children;
            for(let k=0; k<indexChildrenBox.length; k++){
                indexChildrenBox[k].onclick = function (e) {
                    e = e || window.event;
                    let el = e.srcElement;
                    let cls = el.className;
                    let numCenter = this.getElementsByTagName('p')[5];
                    let num = parseInt(numCenter.innerHTML);
                    let less = this.getElementsByTagName('p')[4];
                    switch (cls){
                        case 'numAdd':
                            numCenter.innerHTML = num + 1;
                            less.innerHTML = '-';
                            getSubTotal(this);
                            break;
                        case 'numLess':
                            if (num > 1) {
                                numCenter.innerHTML = num - 1;
                            }
                            if (numCenter.innerHTML <= 1) {
                                less.innerHTML = '';
                            }
                            getSubTotal(this);
                            break;
                        default :
                            break;
                    }
                    getTotal();
                };
            }
        }


        for (let i = 0; i < checkInputs.length; i++) {
            checkInputs[i].onclick = function () {
                if (this.className === 'check-all check') {
                    for (let j = 0; j < checkInputs.length; j++) {
                        checkInputs[j].checked = this.checked;
                    }
                }
                if (this.checked == false) {
                    for (let k = 0; k < checkAll.length; k++) {
                        checkAll[k].checked = false;
                    }
                }
                getTotal();
            }
        }
    });
</script>
</html>
